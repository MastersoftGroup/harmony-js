"use strict";angular.module("hraAutocomplete",[]).directive("hraAutocomplete",function(t,e){function a(t,e,a){t.encodedAuth=btoa(e.hraLogin),t.baseUrl=e.hraUrl||"https://hosted.mastersoftgroup.com",a.jsonp(t.baseUrl+"/harmony/rest/au/generateID?callback=JSON_CALLBACK&Authorization=Basic+"+t.encodedAuth).then(function(e){t.transactionId=(e.data.status="SUCCESS")?e.data.payload:""})}return{restrict:"AE",replace:!0,template:'<input type="text" />',require:"ngModel",controller:function(t,e,n){a(t,e,n)},compile:function(a,n){var r=e(n.ngModel);return function(e,a,n){var o=[],l=n.hraDelay||500,u=n.hraMinLength||3,c=n.hraSot||"AUPAF",s="au";"NZPAF"==c&&(s="nz"),a.autocomplete({minLength:u,delay:l,source:function(a,n){var r=e.baseUrl+"/harmony/rest/"+s+"/address?callback=JSON_CALLBACK&fullAddress="+a.term+"&Authorization=Basic+"+e.encodedAuth+"&sourceOfTruth="+c+"&transactionID="+e.transactionId;t.jsonp(r).success(function(t){return"SUCCESS"==t.status&&(o=$.map(t.payload,function(t){return{label:t.fullAddress}})),n(o)})},select:function(t,e){t.preventDefault(),$(this).val(e.item.label)},change:function(){for(var t=a.val(),n=null,l=0;l<o.length;l++)if(o[l].label===t){n=o[l].label;break}n||e.$apply(function(t){r.assign(t,null)})}})}}}});